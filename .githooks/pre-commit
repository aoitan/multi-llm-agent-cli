#!/usr/bin/env sh
set -eu

STAGED_FORMAT_FILES="$(git diff --cached --name-only --diff-filter=ACM -- '*.ts' '*.md')"

if [ -n "$STAGED_FORMAT_FILES" ]; then
  echo "[pre-commit] Running format on staged .ts/.md files..."
  printf '%s\n' "$STAGED_FORMAT_FILES" | while IFS= read -r file; do
    [ -n "$file" ] || continue
    npx --yes prettier@3 --write "$file"
    git add -- "$file"
  done
else
  echo "[pre-commit] No staged .ts/.md files to format."
fi

echo "[pre-commit] Running lint..."
npm run lint

## 仕様詳細化計画

**目標:** 開発チームが迷いなく実装に着手できるよう、既存ドキュメントの不足している具体性を補完する。

**優先順位:**

1.  **高:** MCPツール定義（内製MCPサーバー向け）、Agent間通信プロトコル
2.  **中:** CLI-Agent間通信プロトコル、設定ファイルスキーマ
3.  **低:** 包括的なエラーハンドリングポリシー、認証・認可メカニズム（これらはコア機能の実装と並行して詳細化を進める）

---

#### 詳細化タスク一覧

以下のタスクを `doc/design/` 配下の既存ドキュメントを更新するか、新規ドキュメントとして追加することで実施します。

**フェーズ1: 最優先事項の詳細化 (MVPに直結)**

*   **タスク1.1: 内製MCPツールの詳細定義**
    *   **目的:** `mcp-server/file-read`、`mcp-server/file-write`、`mcp-server/shell-exec` の具体的なインターフェースを明確にする。
    *   **内容:**
        *   各ツールの `name`、`description`。
        *   `inputSchema` の完全なJSON Schema定義（パラメータの型、必須/任意、デフォルト値）。
        *   `outputSchema` の完全なJSON Schema定義（戻り値の型、構造）。
        *   特にファイルパスの扱い（絶対パス、相対パス、許可されたルートからの相対パスなど）と、シェルコマンドの引数の扱い（配列、文字列など）の具体的な仕様を明記。
        *   各ツール実行時のセキュリティポリシー（例: `file-read` は特定のディレクトリ以下のみ許可、`shell-exec` はブラックリストにないコマンドのみ許可など）を記述。
    *   **成果物:** `doc/design/design_mcp_tools.md` (新規作成または既存ドキュメントの更新)

*   **タスク1.2: Agent間通信プロトコルの詳細定義**
    *   **目的:** Agent間のHTTP REST通信の具体的なAPIエンドポイントとデータ構造を明確にする。
    *   **内容:**
        *   各Agentが提供するAPIのエンドポイント一覧（パス、HTTPメソッド）。
        *   各APIエンドポイントにおけるリクエストボディとレスポンスボディの完全なJSON Schema定義。
        *   Agent間の認証・認可メカニズム（例: 共有シークレット、APIキーなど）の具体的な仕様。
    *   **成果物:** `doc/design/design_agent_communication.md` (新規作成)

**フェーズ2: 次の優先事項の詳細化**

*   **タスク2.1: CLI-Agent間通信プロトコルの詳細定義**
    *   **目的:** CLIがCoordinator Agentをどのように起動し、タスクを送信し、結果を受信するかの具体的なメカニズムを明確にする。
    *   **内容:**
        *   CLIからAgentへのタスク送信、Agentからの結果受信の具体的なデータ構造と通信方法（例: コマンドライン引数、環境変数、HTTP/IPCなど）。
    *   **成果物:** `doc/design/design_cli_agent_communication.md` (新規作成)

*   **タスク2.2: 設定ファイルスキーマの詳細定義**
    *   **目的:** `agent-config.yaml` および `config.yaml` の具体的な構造を明確にする。
    *   **内容:**
        *   `agent-config.yaml` および `config.yaml` のすべてのフィールド名、型、必須/任意、デフォルト値の完全なスキーマ定義。
    *   **成果物:** `doc/design/design_configuration_schema.md` (新規作成)

**フェーズ3: その他の詳細化 (MVP実装と並行して進行)**

*   **タスク3.1: 包括的なエラーハンドリングポリシーの策定**
    *   **目的:** アプリケーション全体のエラーハンドリングに関する具体的なポリシーとガイドラインを定義する。
    *   **内容:**
        *   エラーの種類ごとの具体的な処理フロー（APIエラー、ネットワークエラー、ロジックエラーなど）。
        *   ロギングのフォーマットとレベル、ログの保存場所。
        *   リトライ/フォールバックの具体的な条件と回数。
    *   **成果物:** `doc/design/design_error_handling_policy.md` (既存ドキュメントの更新または新規作成)

*   **タスク3.2: 認証・認可メカニズムの詳細化**
    *   **目的:** システム全体の認証・認可に関する具体的なメカニズムを定義する。
    *   **内容:**
        *   トークン形式、検証方法、権限付与の粒度など。
    *   **成果物:** `doc/design/design_authentication_authorization.md` (新規作成)

---

**進め方:**

1.  まず、フェーズ1のタスクから着手し、それぞれの成果物をMarkdown形式で作成・更新します。
2.  各タスクが完了次第、開発チームと共有し、フィードバックを収集します。
3.  フィードバックを元に必要に応じてドキュメントを修正し、次のフェーズのタスクに進みます。

この計画により、開発チームは必要な情報を段階的に得ることができ、効率的に実装を進められると期待します。
